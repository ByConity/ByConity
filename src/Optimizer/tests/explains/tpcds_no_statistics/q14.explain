Projection est. 100 rows
│     Expressions: channel:=`expr#'store'_1`, i_brand_id:=i_brand_id_9, i_category_id:=i_category_id_9, i_class_id:=i_class_id_9, sum(number_sales):=`expr#sum(number_sales)`, sum(sales):=`expr#sum(sales)`
└─ Limit est. 100 rows
   │     Limit: 100
   └─ Sorting est. ? rows
      │     Order by: {expr#'store'_1 asc, i_brand_id_9 asc, i_class_id_9 asc, i_category_id_9 asc}
      │     Limit: 100
      └─ Gather Exchange est. ? rows
         └─ Sorting est. ? rows
            │     Order by: {expr#'store'_1 asc, i_brand_id_9 asc, i_class_id_9 asc, i_category_id_9 asc}
            │     Limit: 100
            └─ Aggregating est. ? rows
               │     Group by: {expr#'store'_1, i_brand_id_9, i_category_id_9, i_class_id_9}
               │     Aggregates: expr#sum(sales):=AggNull(sum)(expr#sum(multiply(ss_quantity, ss_list_price))_1), expr#sum(number_sales):=AggNull(sum)(expr#count()_3)
               └─ Union est. ? rows
                  ├─ Projection est. ? rows
                  │  │     Expressions: [expr#count(), expr#sum(multiply(ss_quantity, ss_list_price)), i_brand_id, i_category_id, i_class_id], expr#'store':='store'
                  │  └─ Inner Join est. ? rows
                  │     │     Condition: 
                  │     │     Filter: `expr#sum(multiply(ss_quantity, ss_list_price))` > `expr#avg(multiply(quantity, list_price))_1`
                  │     ├─ MergingAggregated est. ? rows
                  │     │  └─ Repartition Exchange est. ? rows
                  │     │     │     Partition by: {i_brand_id, i_category_id, i_class_id}
                  │     │     └─ Aggregating est. ? rows
                  │     │        │     Group by: {i_brand_id, i_category_id, i_class_id}
                  │     │        │     Aggregates: expr#sum(multiply(ss_quantity, ss_list_price)):=AggNull(sum)(expr#multiply(ss_quantity, ss_list_price)), expr#count():=AggNull(count)()
                  │     │        └─ Projection est. ? rows
                  │     │           │     Expressions: [i_brand_id, i_category_id, i_class_id], expr#multiply(ss_quantity, ss_list_price):=ss_quantity * ss_list_price
                  │     │           └─ Inner Join est. ? rows
                  │     │              │     Condition: i_item_sk == i_item_sk_5
                  │     │              ├─ Repartition Exchange est. ? rows
                  │     │              │  │     Partition by: {i_item_sk}
                  │     │              │  └─ Inner Join est. ? rows
                  │     │              │     │     Condition: ss_sold_date_sk == d_date_sk
                  │     │              │     ├─ Repartition Exchange est. ? rows
                  │     │              │     │  │     Partition by: {ss_sold_date_sk}
                  │     │              │     │  └─ Inner Join est. ? rows
                  │     │              │     │     │     Condition: ss_item_sk == i_item_sk
                  │     │              │     │     ├─ Repartition Exchange est. ? rows
                  │     │              │     │     │  │     Partition by: {ss_item_sk}
                  │     │              │     │     │  └─ Filter est. ? rows
                  │     │              │     │     │     │     Condition: isNotNull(ss_item_sk)
                  │     │              │     │     │     └─ TableScan tpcds.store_sales est. ? rows
                  │     │              │     │     │              Outputs: [ss_item_sk, ss_list_price, ss_quantity, ss_sold_date_sk]
                  │     │              │     │     └─ Repartition Exchange est. ? rows
                  │     │              │     │        │     Partition by: {i_item_sk}
                  │     │              │     │        └─ Filter est. ? rows
                  │     │              │     │           │     Condition: isNotNull(i_item_sk)
                  │     │              │     │           └─ TableScan tpcds.item est. ? rows
                  │     │              │     │                    Outputs: [i_brand_id, i_category_id, i_class_id, i_item_sk]
                  │     │              │     └─ Repartition Exchange est. ? rows
                  │     │              │        │     Partition by: {d_date_sk}
                  │     │              │        └─ Filter est. ? rows
                  │     │              │           │     Condition: (d_moy = 11) AND (d_year = 2001)
                  │     │              │           └─ TableScan tpcds.date_dim est. ? rows
                  │     │              │                    Outputs: [d_date_sk, d_moy, d_year]
                  │     │              └─ Aggregating est. ? rows
                  │     │                 │     Group by: {i_item_sk_5}
                  │     │                 └─ Filter est. ? rows
                  │     │                    │     Condition: isNotNull(i_item_sk_5)
                  │     │                    └─ CTERef [0] est. ? rows
                  │     └─ Broadcast Exchange est. ? rows
                  │        └─ EnforceSingleRow est. ? rows
                  │           └─ CTERef [1] est. ? rows
                  ├─ Projection est. ? rows
                  │  │     Expressions: [expr#count()_1, expr#sum(multiply(cs_quantity, cs_list_price)), i_brand_id_7, i_category_id_7, i_class_id_7], expr#'catalog':='catalog'
                  │  └─ Inner Join est. ? rows
                  │     │     Condition: 
                  │     │     Filter: `expr#sum(multiply(cs_quantity, cs_list_price))` > `expr#avg(multiply(quantity, list_price))_2`
                  │     ├─ MergingAggregated est. ? rows
                  │     │  └─ Repartition Exchange est. ? rows
                  │     │     │     Partition by: {i_brand_id_7, i_category_id_7, i_class_id_7}
                  │     │     └─ Aggregating est. ? rows
                  │     │        │     Group by: {i_brand_id_7, i_category_id_7, i_class_id_7}
                  │     │        │     Aggregates: expr#sum(multiply(cs_quantity, cs_list_price)):=AggNull(sum)(expr#multiply(cs_quantity, cs_list_price)), expr#count()_1:=AggNull(count)()
                  │     │        └─ Projection est. ? rows
                  │     │           │     Expressions: [i_brand_id_7, i_category_id_7, i_class_id_7], expr#multiply(cs_quantity, cs_list_price):=cs_quantity_2 * cs_list_price_2
                  │     │           └─ Inner Join est. ? rows
                  │     │              │     Condition: cs_item_sk_2 == i_item_sk_7
                  │     │              ├─ Repartition Exchange est. ? rows
                  │     │              │  │     Partition by: {cs_item_sk_2}
                  │     │              │  └─ Inner Join est. ? rows
                  │     │              │     │     Condition: cs_sold_date_sk_2 == d_date_sk_7
                  │     │              │     ├─ Repartition Exchange est. ? rows
                  │     │              │     │  │     Partition by: {cs_sold_date_sk_2}
                  │     │              │     │  └─ Inner Join est. ? rows
                  │     │              │     │     │     Condition: cs_item_sk_2 == i_item_sk_6
                  │     │              │     │     ├─ Repartition Exchange est. ? rows
                  │     │              │     │     │  │     Partition by: {cs_item_sk_2}
                  │     │              │     │     │  └─ Filter est. ? rows
                  │     │              │     │     │     │     Condition: isNotNull(cs_item_sk_2)
                  │     │              │     │     │     └─ TableScan tpcds.catalog_sales est. ? rows
                  │     │              │     │     │              Outputs: cs_item_sk_2:=cs_item_sk, cs_list_price_2:=cs_list_price, cs_quantity_2:=cs_quantity, cs_sold_date_sk_2:=cs_sold_date_sk
                  │     │              │     │     └─ Repartition Exchange est. ? rows
                  │     │              │     │        │     Partition by: {i_item_sk_6}
                  │     │              │     │        └─ Filter est. ? rows
                  │     │              │     │           │     Condition: isNotNull(i_item_sk_6)
                  │     │              │     │           └─ TableScan tpcds.item est. ? rows
                  │     │              │     │                    Outputs: i_brand_id_7:=i_brand_id, i_category_id_7:=i_category_id, i_class_id_7:=i_class_id, i_item_sk_6:=i_item_sk
                  │     │              │     └─ Repartition Exchange est. ? rows
                  │     │              │        │     Partition by: {d_date_sk_7}
                  │     │              │        └─ Filter est. ? rows
                  │     │              │           │     Condition: (d_year_7 = 2001) AND (d_moy_7 = 11)
                  │     │              │           └─ TableScan tpcds.date_dim est. ? rows
                  │     │              │                    Outputs: d_date_sk_7:=d_date_sk, d_moy_7:=d_moy, d_year_7:=d_year
                  │     │              └─ Aggregating est. ? rows
                  │     │                 │     Group by: {i_item_sk_7}
                  │     │                 └─ Filter est. ? rows
                  │     │                    │     Condition: isNotNull(i_item_sk_7)
                  │     │                    └─ CTERef [0] est. ? rows
                  │     └─ Broadcast Exchange est. ? rows
                  │        └─ EnforceSingleRow est. ? rows
                  │           └─ CTERef [1] est. ? rows
                  └─ Projection est. ? rows
                     │     Expressions: [expr#count()_2, expr#sum(multiply(ws_quantity, ws_list_price)), i_brand_id_8, i_category_id_8, i_class_id_8], expr#'web':='web'
                     └─ Inner Join est. ? rows
                        │     Condition: 
                        │     Filter: `expr#sum(multiply(ws_quantity, ws_list_price))` > `expr#avg(multiply(quantity, list_price))_3`
                        ├─ MergingAggregated est. ? rows
                        │  └─ Repartition Exchange est. ? rows
                        │     │     Partition by: {i_brand_id_8, i_category_id_8, i_class_id_8}
                        │     └─ Aggregating est. ? rows
                        │        │     Group by: {i_brand_id_8, i_category_id_8, i_class_id_8}
                        │        │     Aggregates: expr#sum(multiply(ws_quantity, ws_list_price)):=AggNull(sum)(expr#multiply(ws_quantity, ws_list_price)), expr#count()_2:=AggNull(count)()
                        │        └─ Projection est. ? rows
                        │           │     Expressions: [i_brand_id_8, i_category_id_8, i_class_id_8], expr#multiply(ws_quantity, ws_list_price):=ws_quantity_2 * ws_list_price_2
                        │           └─ Inner Join est. ? rows
                        │              │     Condition: i_item_sk_8 == i_item_sk_9
                        │              ├─ Repartition Exchange est. ? rows
                        │              │  │     Partition by: {i_item_sk_8}
                        │              │  └─ Inner Join est. ? rows
                        │              │     │     Condition: ws_sold_date_sk_2 == d_date_sk_8
                        │              │     ├─ Repartition Exchange est. ? rows
                        │              │     │  │     Partition by: {ws_sold_date_sk_2}
                        │              │     │  └─ Inner Join est. ? rows
                        │              │     │     │     Condition: ws_item_sk_2 == i_item_sk_8
                        │              │     │     ├─ Repartition Exchange est. ? rows
                        │              │     │     │  │     Partition by: {ws_item_sk_2}
                        │              │     │     │  └─ Filter est. ? rows
                        │              │     │     │     │     Condition: isNotNull(ws_item_sk_2)
                        │              │     │     │     └─ TableScan tpcds.web_sales est. ? rows
                        │              │     │     │              Outputs: ws_item_sk_2:=ws_item_sk, ws_list_price_2:=ws_list_price, ws_quantity_2:=ws_quantity, ws_sold_date_sk_2:=ws_sold_date_sk
                        │              │     │     └─ Repartition Exchange est. ? rows
                        │              │     │        │     Partition by: {i_item_sk_8}
                        │              │     │        └─ Filter est. ? rows
                        │              │     │           │     Condition: isNotNull(i_item_sk_8)
                        │              │     │           └─ TableScan tpcds.item est. ? rows
                        │              │     │                    Outputs: i_brand_id_8:=i_brand_id, i_category_id_8:=i_category_id, i_class_id_8:=i_class_id, i_item_sk_8:=i_item_sk
                        │              │     └─ Repartition Exchange est. ? rows
                        │              │        │     Partition by: {d_date_sk_8}
                        │              │        └─ Filter est. ? rows
                        │              │           │     Condition: (d_year_8 = 2001) AND (d_moy_8 = 11)
                        │              │           └─ TableScan tpcds.date_dim est. ? rows
                        │              │                    Outputs: d_date_sk_8:=d_date_sk, d_moy_8:=d_moy, d_year_8:=d_year
                        │              └─ Aggregating est. ? rows
                        │                 │     Group by: {i_item_sk_9}
                        │                 └─ Filter est. ? rows
                        │                    │     Condition: isNotNull(i_item_sk_9)
                        │                    └─ CTERef [0] est. ? rows
                        └─ Broadcast Exchange est. ? rows
                           └─ EnforceSingleRow est. ? rows
                              └─ CTERef [1] est. ? rows
CTEDef [1]
MergingAggregated est. ? rows
└─ Gather Exchange est. ? rows
   └─ Aggregating est. ? rows
      │     Group by: {}
      │     Aggregates: expr#avg(multiply(quantity, list_price)):=AggNull(avg)(expr#multiply(quantity, list_price))
      └─ Projection est. ? rows
         │     Expressions: expr#multiply(quantity, list_price):=ss_quantity_3 * ss_list_price_3
         └─ Union est. ? rows
            ├─ Inner Join est. ? rows
            │  │     Condition: ss_sold_date_sk_2 == d_date_sk_4
            │  ├─ Repartition Exchange est. ? rows
            │  │  │     Partition by: {ss_sold_date_sk_2}
            │  │  └─ TableScan tpcds.store_sales est. ? rows
            │  │           Outputs: ss_list_price_2:=ss_list_price, ss_quantity_2:=ss_quantity, ss_sold_date_sk_2:=ss_sold_date_sk
            │  └─ Repartition Exchange est. ? rows
            │     │     Partition by: {d_date_sk_4}
            │     └─ Filter est. ? rows
            │        │     Condition: (d_year_4 >= 1999) AND (d_year_4 <= 2001)
            │        └─ TableScan tpcds.date_dim est. ? rows
            │                 Outputs: d_date_sk_4:=d_date_sk, d_year_4:=d_year
            ├─ Inner Join est. ? rows
            │  │     Condition: cs_sold_date_sk_1 == d_date_sk_5
            │  ├─ Repartition Exchange est. ? rows
            │  │  │     Partition by: {cs_sold_date_sk_1}
            │  │  └─ TableScan tpcds.catalog_sales est. ? rows
            │  │           Outputs: cs_list_price_1:=cs_list_price, cs_quantity_1:=cs_quantity, cs_sold_date_sk_1:=cs_sold_date_sk
            │  └─ Repartition Exchange est. ? rows
            │     │     Partition by: {d_date_sk_5}
            │     └─ Filter est. ? rows
            │        │     Condition: (d_year_5 <= 2001) AND (d_year_5 >= 1999)
            │        └─ TableScan tpcds.date_dim est. ? rows
            │                 Outputs: d_date_sk_5:=d_date_sk, d_year_5:=d_year
            └─ Inner Join est. ? rows
               │     Condition: ws_sold_date_sk_1 == d_date_sk_6
               ├─ Repartition Exchange est. ? rows
               │  │     Partition by: {ws_sold_date_sk_1}
               │  └─ TableScan tpcds.web_sales est. ? rows
               │           Outputs: ws_list_price_1:=ws_list_price, ws_quantity_1:=ws_quantity, ws_sold_date_sk_1:=ws_sold_date_sk
               └─ Repartition Exchange est. ? rows
                  │     Partition by: {d_date_sk_6}
                  └─ Filter est. ? rows
                     │     Condition: (d_year_6 >= 1999) AND (d_year_6 <= 2001)
                     └─ TableScan tpcds.date_dim est. ? rows
                              Outputs: d_date_sk_6:=d_date_sk, d_year_6:=d_year
CTEDef [0]
Repartition Exchange est. ? rows
│     Partition by: {i_item_sk_1}
└─ Inner Join est. ? rows
   │     Condition: i_brand_id_1 == i_brand_id_6, i_category_id_1 == i_category_id_6, i_class_id_1 == i_class_id_6
   ├─ Repartition Exchange est. ? rows
   │  │     Partition by: {i_brand_id_1, i_category_id_1, i_class_id_1}
   │  └─ Filter est. ? rows
   │     │     Condition: isNotNull(i_item_sk_1)
   │     └─ TableScan tpcds.item est. ? rows
   │              Outputs: i_brand_id_1:=i_brand_id, i_category_id_1:=i_category_id, i_class_id_1:=i_class_id, i_item_sk_1:=i_item_sk
   └─ Repartition Exchange est. ? rows
      │     Partition by: {i_brand_id_6, i_category_id_6, i_class_id_6}
      └─ Filter est. ? rows
         │     Condition: (count_1 >= 1) AND (count_2 >= 1) AND (count >= 1)
         └─ MergingAggregated est. ? rows
            └─ Repartition Exchange est. ? rows
               │     Partition by: {i_brand_id_6, i_category_id_6, i_class_id_6}
               └─ Aggregating est. ? rows
                  │     Group by: {i_brand_id_6, i_category_id_6, i_class_id_6}
                  │     Aggregates: count:=AggNull(sum)(marker), count_1:=AggNull(sum)(marker_1), count_2:=AggNull(sum)(marker_2)
                  └─ Union est. ? rows
                     ├─ Projection est. ? rows
                     │  │     Expressions: [i_brand_id_2, i_category_id_2, i_class_id_2], marker_3:=1, marker_4:=0, marker_5:=0
                     │  └─ Inner Join est. ? rows
                     │     │     Condition: ss_sold_date_sk_1 == d_date_sk_1
                     │     ├─ Repartition Exchange est. ? rows
                     │     │  │     Partition by: {ss_sold_date_sk_1}
                     │     │  └─ Inner Join est. ? rows
                     │     │     │     Condition: ss_item_sk_1 == i_item_sk_2
                     │     │     ├─ Repartition Exchange est. ? rows
                     │     │     │  │     Partition by: {ss_item_sk_1}
                     │     │     │  └─ TableScan tpcds.store_sales est. ? rows
                     │     │     │           Outputs: ss_item_sk_1:=ss_item_sk, ss_sold_date_sk_1:=ss_sold_date_sk
                     │     │     └─ Repartition Exchange est. ? rows
                     │     │        │     Partition by: {i_item_sk_2}
                     │     │        └─ TableScan tpcds.item est. ? rows
                     │     │                 Outputs: i_brand_id_2:=i_brand_id, i_category_id_2:=i_category_id, i_class_id_2:=i_class_id, i_item_sk_2:=i_item_sk
                     │     └─ Repartition Exchange est. ? rows
                     │        │     Partition by: {d_date_sk_1}
                     │        └─ Filter est. ? rows
                     │           │     Condition: (d_year_1 <= 2001) AND (d_year_1 >= 1999)
                     │           └─ TableScan tpcds.date_dim est. ? rows
                     │                    Outputs: d_date_sk_1:=d_date_sk, d_year_1:=d_year
                     ├─ Projection est. ? rows
                     │  │     Expressions: [i_brand_id_3, i_category_id_3, i_class_id_3], marker_6:=0, marker_7:=1, marker_8:=0
                     │  └─ Inner Join est. ? rows
                     │     │     Condition: cs_sold_date_sk == d_date_sk_2
                     │     ├─ Repartition Exchange est. ? rows
                     │     │  │     Partition by: {cs_sold_date_sk}
                     │     │  └─ Inner Join est. ? rows
                     │     │     │     Condition: cs_item_sk == i_item_sk_3
                     │     │     ├─ Repartition Exchange est. ? rows
                     │     │     │  │     Partition by: {cs_item_sk}
                     │     │     │  └─ TableScan tpcds.catalog_sales est. ? rows
                     │     │     │           Outputs: [cs_item_sk, cs_sold_date_sk]
                     │     │     └─ Repartition Exchange est. ? rows
                     │     │        │     Partition by: {i_item_sk_3}
                     │     │        └─ TableScan tpcds.item est. ? rows
                     │     │                 Outputs: i_brand_id_3:=i_brand_id, i_category_id_3:=i_category_id, i_class_id_3:=i_class_id, i_item_sk_3:=i_item_sk
                     │     └─ Repartition Exchange est. ? rows
                     │        │     Partition by: {d_date_sk_2}
                     │        └─ Filter est. ? rows
                     │           │     Condition: (d_year_2 <= 2001) AND (d_year_2 >= 1999)
                     │           └─ TableScan tpcds.date_dim est. ? rows
                     │                    Outputs: d_date_sk_2:=d_date_sk, d_year_2:=d_year
                     └─ Projection est. ? rows
                        │     Expressions: [i_brand_id_5, i_category_id_5, i_class_id_5], marker_10:=0, marker_11:=1, marker_9:=0
                        └─ Inner Join est. ? rows
                           │     Condition: ws_sold_date_sk == d_date_sk_3
                           ├─ Repartition Exchange est. ? rows
                           │  │     Partition by: {ws_sold_date_sk}
                           │  └─ Inner Join est. ? rows
                           │     │     Condition: ws_item_sk == i_item_sk_4
                           │     ├─ Repartition Exchange est. ? rows
                           │     │  │     Partition by: {ws_item_sk}
                           │     │  └─ TableScan tpcds.web_sales est. ? rows
                           │     │           Outputs: [ws_item_sk, ws_sold_date_sk]
                           │     └─ Repartition Exchange est. ? rows
                           │        │     Partition by: {i_item_sk_4}
                           │        └─ TableScan tpcds.item est. ? rows
                           │                 Outputs: i_brand_id_5:=i_brand_id, i_category_id_5:=i_category_id, i_class_id_5:=i_class_id, i_item_sk_4:=i_item_sk
                           └─ Repartition Exchange est. ? rows
                              │     Partition by: {d_date_sk_3}
                              └─ Filter est. ? rows
                                 │     Condition: (d_year_3 <= 2001) AND (d_year_3 >= 1999)
                                 └─ TableScan tpcds.date_dim est. ? rows
                                          Outputs: d_date_sk_3:=d_date_sk, d_year_3:=d_year
note: CTE(Common Table Expression) is applied for 6 times.
Projection est. 100 rows
│     Expressions: ly_brand:=i_brand_id_17, ly_category:=i_category_id_17, ly_channel:=`expr#'store'_3`, ly_class:=i_class_id_17, ly_number_sales:=`expr#count()_5`, ly_sales:=`expr#sum(multiply(ss_quantity, ss_list_price))_3`, ty_brand:=i_brand_id_10, ty_category:=i_category_id_10, ty_channel:=`expr#'store'_2`, ty_class:=i_class_id_10, ty_number_sales:=`expr#count()_4`, ty_sales:=`expr#sum(multiply(ss_quantity, ss_list_price))_2`
└─ Limit est. 100 rows
   │     Limit: 100
   └─ Sorting est. ? rows
      │     Order by: {expr#'store'_2 asc, i_brand_id_10 asc, i_class_id_10 asc, i_category_id_10 asc}
      │     Limit: 100
      └─ Gather Exchange est. ? rows
         └─ Sorting est. ? rows
            │     Order by: {expr#'store'_2 asc, i_brand_id_10 asc, i_class_id_10 asc, i_category_id_10 asc}
            │     Limit: 100
            └─ Inner Join est. ? rows
               │     Condition: 
               │     Filter: `expr#sum(multiply(ss_quantity, ss_list_price))_3` > `expr#avg(multiply(quantity, list_price))_6`
               ├─ Inner Join est. ? rows
               │  │     Condition: 
               │  │     Filter: `expr#sum(multiply(ss_quantity, ss_list_price))_2` > `expr#avg(multiply(quantity, list_price))_5`
               │  ├─ Inner Join est. ? rows
               │  │  │     Condition: i_brand_id_10 == i_brand_id_17, i_category_id_10 == i_category_id_17, i_class_id_10 == i_class_id_17
               │  │  ├─ Projection est. ? rows
               │  │  │  │     Expressions: [expr#count()_4, expr#sum(multiply(ss_quantity, ss_list_price))_2, i_brand_id_10, i_category_id_10, i_class_id_10], expr#'store'_2:='store'
               │  │  │  └─ MergingAggregated est. ? rows
               │  │  │     └─ Repartition Exchange est. ? rows
               │  │  │        │     Partition by: {i_brand_id_10, i_category_id_10, i_class_id_10}
               │  │  │        └─ Aggregating est. ? rows
               │  │  │           │     Group by: {i_brand_id_10, i_category_id_10, i_class_id_10}
               │  │  │           │     Aggregates: expr#sum(multiply(ss_quantity, ss_list_price))_2:=AggNull(sum)(expr#multiply(ss_quantity, ss_list_price)_1), expr#count()_4:=AggNull(count)()
               │  │  │           └─ Projection est. ? rows
               │  │  │              │     Expressions: [i_brand_id_10, i_category_id_10, i_class_id_10], expr#multiply(ss_quantity, ss_list_price)_1:=ss_quantity_4 * ss_list_price_4
               │  │  │              └─ Inner Join est. ? rows
               │  │  │                 │     Condition: i_item_sk_10 == i_item_sk_15
               │  │  │                 ├─ Repartition Exchange est. ? rows
               │  │  │                 │  │     Partition by: {i_item_sk_10}
               │  │  │                 │  └─ Inner Join est. ? rows
               │  │  │                 │     │     Condition: d_week_seq_9 == d_week_seq_10
               │  │  │                 │     ├─ Repartition Exchange est. ? rows
               │  │  │                 │     │  │     Partition by: {d_week_seq_9}
               │  │  │                 │     │  └─ Inner Join est. ? rows
               │  │  │                 │     │     │     Condition: ss_sold_date_sk_3 == d_date_sk_9
               │  │  │                 │     │     ├─ Repartition Exchange est. ? rows
               │  │  │                 │     │     │  │     Partition by: {ss_sold_date_sk_3}
               │  │  │                 │     │     │  └─ Inner Join est. ? rows
               │  │  │                 │     │     │     │     Condition: ss_item_sk_3 == i_item_sk_10
               │  │  │                 │     │     │     ├─ Repartition Exchange est. ? rows
               │  │  │                 │     │     │     │  │     Partition by: {ss_item_sk_3}
               │  │  │                 │     │     │     │  └─ Filter est. ? rows
               │  │  │                 │     │     │     │     │     Condition: isNotNull(ss_item_sk_3)
               │  │  │                 │     │     │     │     └─ TableScan tpcds.store_sales est. ? rows
               │  │  │                 │     │     │     │              Outputs: ss_item_sk_3:=ss_item_sk, ss_list_price_4:=ss_list_price, ss_quantity_4:=ss_quantity, ss_sold_date_sk_3:=ss_sold_date_sk
               │  │  │                 │     │     │     └─ Repartition Exchange est. ? rows
               │  │  │                 │     │     │        │     Partition by: {i_item_sk_10}
               │  │  │                 │     │     │        └─ Filter est. ? rows
               │  │  │                 │     │     │           │     Condition: isNotNull(i_item_sk_10)
               │  │  │                 │     │     │           └─ TableScan tpcds.item est. ? rows
               │  │  │                 │     │     │                    Outputs: i_brand_id_10:=i_brand_id, i_category_id_10:=i_category_id, i_class_id_10:=i_class_id, i_item_sk_10:=i_item_sk
               │  │  │                 │     │     └─ Repartition Exchange est. ? rows
               │  │  │                 │     │        │     Partition by: {d_date_sk_9}
               │  │  │                 │     │        └─ TableScan tpcds.date_dim est. ? rows
               │  │  │                 │     │                 Outputs: d_date_sk_9:=d_date_sk, d_week_seq_9:=d_week_seq
               │  │  │                 │     └─ Repartition Exchange est. ? rows
               │  │  │                 │        │     Partition by: {d_week_seq_10}
               │  │  │                 │        └─ EnforceSingleRow est. ? rows
               │  │  │                 │           └─ Union est. ? rows
               │  │  │                 │              └─ Gather Exchange est. ? rows
               │  │  │                 │                 └─ Projection est. ? rows
               │  │  │                 │                    │     Expressions: [d_week_seq_10]
               │  │  │                 │                    └─ Filter est. ? rows
               │  │  │                 │                       │     Condition: (d_dom_10 = 11) AND (d_year_10 = 2000) AND (d_moy_10 = 12)
               │  │  │                 │                       └─ TableScan tpcds.date_dim est. ? rows
               │  │  │                 │                                Outputs: d_dom_10:=d_dom, d_moy_10:=d_moy, d_week_seq_10:=d_week_seq, d_year_10:=d_year
               │  │  │                 └─ MergingAggregated est. ? rows
               │  │  │                    └─ Repartition Exchange est. ? rows
               │  │  │                       │     Partition by: {i_item_sk_15}
               │  │  │                       └─ Aggregating est. ? rows
               │  │  │                          │     Group by: {i_item_sk_15}
               │  │  │                          └─ Filter est. ? rows
               │  │  │                             │     Condition: isNotNull(i_item_sk_15)
               │  │  │                             └─ CTERef [0] est. ? rows
               │  │  └─ Projection est. ? rows
               │  │     │     Expressions: [expr#count()_5, expr#sum(multiply(ss_quantity, ss_list_price))_3, i_brand_id_17, i_category_id_17, i_class_id_17], expr#'store'_3:='store'
               │  │     └─ MergingAggregated est. ? rows
               │  │        └─ Repartition Exchange est. ? rows
               │  │           │     Partition by: {i_brand_id_17, i_category_id_17, i_class_id_17}
               │  │           └─ Aggregating est. ? rows
               │  │              │     Group by: {i_brand_id_17, i_category_id_17, i_class_id_17}
               │  │              │     Aggregates: expr#sum(multiply(ss_quantity, ss_list_price))_3:=AggNull(sum)(expr#multiply(ss_quantity, ss_list_price)_2), expr#count()_5:=AggNull(count)()
               │  │              └─ Projection est. ? rows
               │  │                 │     Expressions: [i_brand_id_17, i_category_id_17, i_class_id_17], expr#multiply(ss_quantity, ss_list_price)_2:=ss_quantity_8 * ss_list_price_8
               │  │                 └─ Inner Join est. ? rows
               │  │                    │     Condition: i_item_sk_16 == i_item_sk_17
               │  │                    ├─ Repartition Exchange est. ? rows
               │  │                    │  │     Partition by: {i_item_sk_16}
               │  │                    │  └─ Inner Join est. ? rows
               │  │                    │     │     Condition: d_week_seq_17 == d_week_seq_18
               │  │                    │     ├─ Repartition Exchange est. ? rows
               │  │                    │     │  │     Partition by: {d_week_seq_17}
               │  │                    │     │  └─ Inner Join est. ? rows
               │  │                    │     │     │     Condition: ss_sold_date_sk_6 == d_date_sk_17
               │  │                    │     │     ├─ Repartition Exchange est. ? rows
               │  │                    │     │     │  │     Partition by: {ss_sold_date_sk_6}
               │  │                    │     │     │  └─ Inner Join est. ? rows
               │  │                    │     │     │     │     Condition: ss_item_sk_6 == i_item_sk_16
               │  │                    │     │     │     ├─ Repartition Exchange est. ? rows
               │  │                    │     │     │     │  │     Partition by: {ss_item_sk_6}
               │  │                    │     │     │     │  └─ Filter est. ? rows
               │  │                    │     │     │     │     │     Condition: isNotNull(ss_item_sk_6)
               │  │                    │     │     │     │     └─ TableScan tpcds.store_sales est. ? rows
               │  │                    │     │     │     │              Outputs: ss_item_sk_6:=ss_item_sk, ss_list_price_8:=ss_list_price, ss_quantity_8:=ss_quantity, ss_sold_date_sk_6:=ss_sold_date_sk
               │  │                    │     │     │     └─ Repartition Exchange est. ? rows
               │  │                    │     │     │        │     Partition by: {i_item_sk_16}
               │  │                    │     │     │        └─ Filter est. ? rows
               │  │                    │     │     │           │     Condition: isNotNull(i_item_sk_16)
               │  │                    │     │     │           └─ TableScan tpcds.item est. ? rows
               │  │                    │     │     │                    Outputs: i_brand_id_17:=i_brand_id, i_category_id_17:=i_category_id, i_class_id_17:=i_class_id, i_item_sk_16:=i_item_sk
               │  │                    │     │     └─ Repartition Exchange est. ? rows
               │  │                    │     │        │     Partition by: {d_date_sk_17}
               │  │                    │     │        └─ TableScan tpcds.date_dim est. ? rows
               │  │                    │     │                 Outputs: d_date_sk_17:=d_date_sk, d_week_seq_17:=d_week_seq
               │  │                    │     └─ Repartition Exchange est. ? rows
               │  │                    │        │     Partition by: {d_week_seq_18}
               │  │                    │        └─ EnforceSingleRow est. ? rows
               │  │                    │           └─ Union est. ? rows
               │  │                    │              └─ Gather Exchange est. ? rows
               │  │                    │                 └─ Projection est. ? rows
               │  │                    │                    │     Expressions: [d_week_seq_18]
               │  │                    │                    └─ Filter est. ? rows
               │  │                    │                       │     Condition: (d_dom_18 = 11) AND (d_moy_18 = 12) AND (d_year_18 = 1999)
               │  │                    │                       └─ TableScan tpcds.date_dim est. ? rows
               │  │                    │                                Outputs: d_dom_18:=d_dom, d_moy_18:=d_moy, d_week_seq_18:=d_week_seq, d_year_18:=d_year
               │  │                    └─ MergingAggregated est. ? rows
               │  │                       └─ Repartition Exchange est. ? rows
               │  │                          │     Partition by: {i_item_sk_17}
               │  │                          └─ Aggregating est. ? rows
               │  │                             │     Group by: {i_item_sk_17}
               │  │                             └─ Filter est. ? rows
               │  │                                │     Condition: isNotNull(i_item_sk_17)
               │  │                                └─ CTERef [0] est. ? rows
               │  └─ Broadcast Exchange est. ? rows
               │     └─ EnforceSingleRow est. ? rows
               │        └─ CTERef [1] est. ? rows
               └─ Broadcast Exchange est. ? rows
                  └─ EnforceSingleRow est. ? rows
                     └─ CTERef [1] est. ? rows
CTEDef [1]
MergingAggregated est. ? rows
└─ Gather Exchange est. ? rows
   └─ Aggregating est. ? rows
      │     Group by: {}
      │     Aggregates: expr#avg(multiply(quantity, list_price))_4:=AggNull(avg)(expr#multiply(quantity, list_price)_1)
      └─ Projection est. ? rows
         │     Expressions: expr#multiply(quantity, list_price)_1:=ss_quantity_7 * ss_list_price_7
         └─ Union est. ? rows
            ├─ Inner Join est. ? rows
            │  │     Condition: ss_sold_date_sk_5 == d_date_sk_14
            │  ├─ Repartition Exchange est. ? rows
            │  │  │     Partition by: {ss_sold_date_sk_5}
            │  │  └─ TableScan tpcds.store_sales est. ? rows
            │  │           Outputs: ss_list_price_6:=ss_list_price, ss_quantity_6:=ss_quantity, ss_sold_date_sk_5:=ss_sold_date_sk
            │  └─ Repartition Exchange est. ? rows
            │     │     Partition by: {d_date_sk_14}
            │     └─ Filter est. ? rows
            │        │     Condition: (d_year_14 <= 2001) AND (d_year_14 >= 1999)
            │        └─ TableScan tpcds.date_dim est. ? rows
            │                 Outputs: d_date_sk_14:=d_date_sk, d_year_14:=d_year
            ├─ Inner Join est. ? rows
            │  │     Condition: cs_sold_date_sk_4 == d_date_sk_15
            │  ├─ Repartition Exchange est. ? rows
            │  │  │     Partition by: {cs_sold_date_sk_4}
            │  │  └─ TableScan tpcds.catalog_sales est. ? rows
            │  │           Outputs: cs_list_price_4:=cs_list_price, cs_quantity_4:=cs_quantity, cs_sold_date_sk_4:=cs_sold_date_sk
            │  └─ Repartition Exchange est. ? rows
            │     │     Partition by: {d_date_sk_15}
            │     └─ Filter est. ? rows
            │        │     Condition: (d_year_15 >= 1999) AND (d_year_15 <= 2001)
            │        └─ TableScan tpcds.date_dim est. ? rows
            │                 Outputs: d_date_sk_15:=d_date_sk, d_year_15:=d_year
            └─ Inner Join est. ? rows
               │     Condition: ws_sold_date_sk_4 == d_date_sk_16
               ├─ Repartition Exchange est. ? rows
               │  │     Partition by: {ws_sold_date_sk_4}
               │  └─ TableScan tpcds.web_sales est. ? rows
               │           Outputs: ws_list_price_4:=ws_list_price, ws_quantity_4:=ws_quantity, ws_sold_date_sk_4:=ws_sold_date_sk
               └─ Repartition Exchange est. ? rows
                  │     Partition by: {d_date_sk_16}
                  └─ Filter est. ? rows
                     │     Condition: (d_year_16 <= 2001) AND (d_year_16 >= 1999)
                     └─ TableScan tpcds.date_dim est. ? rows
                              Outputs: d_date_sk_16:=d_date_sk, d_year_16:=d_year
CTEDef [0]
Inner Join est. ? rows
│     Condition: i_brand_id_11 == i_brand_id_16, i_category_id_11 == i_category_id_16, i_class_id_11 == i_class_id_16
├─ Repartition Exchange est. ? rows
│  │     Partition by: {i_brand_id_11, i_category_id_11, i_class_id_11}
│  └─ Filter est. ? rows
│     │     Condition: isNotNull(i_item_sk_11)
│     └─ TableScan tpcds.item est. ? rows
│              Outputs: i_brand_id_11:=i_brand_id, i_category_id_11:=i_category_id, i_class_id_11:=i_class_id, i_item_sk_11:=i_item_sk
└─ Repartition Exchange est. ? rows
   │     Partition by: {i_brand_id_16, i_category_id_16, i_class_id_16}
   └─ Filter est. ? rows
      │     Condition: (count_5 >= 1) AND (count_4 >= 1) AND (count_3 >= 1)
      └─ MergingAggregated est. ? rows
         └─ Repartition Exchange est. ? rows
            │     Partition by: {i_brand_id_16, i_category_id_16, i_class_id_16}
            └─ Aggregating est. ? rows
               │     Group by: {i_brand_id_16, i_category_id_16, i_class_id_16}
               │     Aggregates: count_3:=AggNull(sum)(marker_12), count_4:=AggNull(sum)(marker_13), count_5:=AggNull(sum)(marker_14)
               └─ Union est. ? rows
                  ├─ Projection est. ? rows
                  │  │     Expressions: [i_brand_id_12, i_category_id_12, i_class_id_12], marker_15:=1, marker_16:=0, marker_17:=0
                  │  └─ Inner Join est. ? rows
                  │     │     Condition: ss_sold_date_sk_4 == d_date_sk_11
                  │     ├─ Repartition Exchange est. ? rows
                  │     │  │     Partition by: {ss_sold_date_sk_4}
                  │     │  └─ Inner Join est. ? rows
                  │     │     │     Condition: ss_item_sk_4 == i_item_sk_12
                  │     │     ├─ Repartition Exchange est. ? rows
                  │     │     │  │     Partition by: {ss_item_sk_4}
                  │     │     │  └─ TableScan tpcds.store_sales est. ? rows
                  │     │     │           Outputs: ss_item_sk_4:=ss_item_sk, ss_sold_date_sk_4:=ss_sold_date_sk
                  │     │     └─ Repartition Exchange est. ? rows
                  │     │        │     Partition by: {i_item_sk_12}
                  │     │        └─ TableScan tpcds.item est. ? rows
                  │     │                 Outputs: i_brand_id_12:=i_brand_id, i_category_id_12:=i_category_id, i_class_id_12:=i_class_id, i_item_sk_12:=i_item_sk
                  │     └─ Repartition Exchange est. ? rows
                  │        │     Partition by: {d_date_sk_11}
                  │        └─ Filter est. ? rows
                  │           │     Condition: (d_year_11 <= 2001) AND (d_year_11 >= 1999)
                  │           └─ TableScan tpcds.date_dim est. ? rows
                  │                    Outputs: d_date_sk_11:=d_date_sk, d_year_11:=d_year
                  ├─ Projection est. ? rows
                  │  │     Expressions: [i_brand_id_13, i_category_id_13, i_class_id_13], marker_18:=0, marker_19:=1, marker_20:=0
                  │  └─ Inner Join est. ? rows
                  │     │     Condition: cs_sold_date_sk_3 == d_date_sk_12
                  │     ├─ Repartition Exchange est. ? rows
                  │     │  │     Partition by: {cs_sold_date_sk_3}
                  │     │  └─ Inner Join est. ? rows
                  │     │     │     Condition: cs_item_sk_3 == i_item_sk_13
                  │     │     ├─ Repartition Exchange est. ? rows
                  │     │     │  │     Partition by: {cs_item_sk_3}
                  │     │     │  └─ TableScan tpcds.catalog_sales est. ? rows
                  │     │     │           Outputs: cs_item_sk_3:=cs_item_sk, cs_sold_date_sk_3:=cs_sold_date_sk
                  │     │     └─ Repartition Exchange est. ? rows
                  │     │        │     Partition by: {i_item_sk_13}
                  │     │        └─ TableScan tpcds.item est. ? rows
                  │     │                 Outputs: i_brand_id_13:=i_brand_id, i_category_id_13:=i_category_id, i_class_id_13:=i_class_id, i_item_sk_13:=i_item_sk
                  │     └─ Repartition Exchange est. ? rows
                  │        │     Partition by: {d_date_sk_12}
                  │        └─ Filter est. ? rows
                  │           │     Condition: (d_year_12 <= 2001) AND (d_year_12 >= 1999)
                  │           └─ TableScan tpcds.date_dim est. ? rows
                  │                    Outputs: d_date_sk_12:=d_date_sk, d_year_12:=d_year
                  └─ Projection est. ? rows
                     │     Expressions: [i_brand_id_15, i_category_id_15, i_class_id_15], marker_21:=0, marker_22:=0, marker_23:=1
                     └─ Inner Join est. ? rows
                        │     Condition: ws_sold_date_sk_3 == d_date_sk_13
                        ├─ Repartition Exchange est. ? rows
                        │  │     Partition by: {ws_sold_date_sk_3}
                        │  └─ Inner Join est. ? rows
                        │     │     Condition: ws_item_sk_3 == i_item_sk_14
                        │     ├─ Repartition Exchange est. ? rows
                        │     │  │     Partition by: {ws_item_sk_3}
                        │     │  └─ TableScan tpcds.web_sales est. ? rows
                        │     │           Outputs: ws_item_sk_3:=ws_item_sk, ws_sold_date_sk_3:=ws_sold_date_sk
                        │     └─ Repartition Exchange est. ? rows
                        │        │     Partition by: {i_item_sk_14}
                        │        └─ TableScan tpcds.item est. ? rows
                        │                 Outputs: i_brand_id_15:=i_brand_id, i_category_id_15:=i_category_id, i_class_id_15:=i_class_id, i_item_sk_14:=i_item_sk
                        └─ Repartition Exchange est. ? rows
                           │     Partition by: {d_date_sk_13}
                           └─ Filter est. ? rows
                              │     Condition: (d_year_13 >= 1999) AND (d_year_13 <= 2001)
                              └─ TableScan tpcds.date_dim est. ? rows
                                       Outputs: d_date_sk_13:=d_date_sk, d_year_13:=d_year
note: CTE(Common Table Expression) is applied for 4 times.
