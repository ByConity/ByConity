set use_uncompressed_cache = 0 and write data in memory format

select id, string_params, string_params{\'s1\'}, string_list_params from test.10027_test_map_in_memory_format
1000	{'s1':'s_v1','s2':'s_v2'}	s_v1	{'s_l1':['l_v1','l_v2','l_v3']}

select id, int_params, int_params{\'i1\'}, int_list_params from test.10027_test_map_in_memory_format
1000	{'i1':1,'i2':2}	1	{'i_l1':[1,2,3],'i_l2':[4,5,6]}

select name, part_type, compact_map from system.parts where table = \'10027_test_map_in_memory_format\' and active = 1
all_1_1_0	InMemory	1
--------------------------------------------------------------
set use_uncompressed_cache = 1 and write data in memory format

select id, string_params, string_params{\'s1\'}, string_list_params from test.10027_test_map_in_memory_format
1000	{'s1':'s_v1','s2':'s_v2'}	s_v1	{'s_l1':['l_v1','l_v2','l_v3']}
1001	{'s3':'s_v3','s4':'s_v4'}	\N	{'s_l2':['l_v4','l_v5']}

select id, int_params, int_params{\'i1\'}, int_list_params from test.10027_test_map_in_memory_format
1000	{'i1':1,'i2':2}	1	{'i_l1':[1,2,3],'i_l2':[4,5,6]}
1001	{'i2':1,'i3':3}	\N	{'i_l3':[4,5,6,7]}

select name, part_type, compact_map from system.parts where table = \'10027_test_map_in_memory_format\' and active = 1
all_1_1_0	InMemory	1
all_2_2_0	InMemory	1
--------------------------------------------------------------
trigger merge action, it will generate parts in compact format

select id, string_params, string_params{\'s1\'}, string_list_params from test.10027_test_map_in_memory_format
1000	{'s1':'s_v1','s2':'s_v2'}	s_v1	{'s_l1':['l_v1','l_v2','l_v3']}
1001	{'s3':'s_v3','s4':'s_v4'}	\N	{'s_l2':['l_v4','l_v5']}

select id, int_params, int_params{\'i1\'}, int_list_params from test.10027_test_map_in_memory_format
1000	{'i1':1,'i2':2}	1	{'i_l1':[1,2,3],'i_l2':[4,5,6]}
1001	{'i2':1,'i3':3}	\N	{'i_l3':[4,5,6,7]}

select name, part_type, compact_map from system.parts where table = \'10027_test_map_in_memory_format\' and active = 1
all_1_2_1	Compact	1
-------------------------------------------------------------
alter settings and trigger merge action, it will generate parts in wide format

select id, string_params, string_params{\'s1\'}, string_list_params from test.10027_test_map_in_memory_format
1000	{'s1':'s_v1','s2':'s_v2'}	s_v1	{'s_l1':['l_v1','l_v2','l_v3']}
1001	{'s3':'s_v3','s4':'s_v4'}	\N	{'s_l2':['l_v4','l_v5']}

select id, int_params, int_params{\'i1\'}, int_list_params from test.10027_test_map_in_memory_format
1000	{'i1':1,'i2':2}	1	{'i_l1':[1,2,3],'i_l2':[4,5,6]}
1001	{'i2':1,'i3':3}	\N	{'i_l3':[4,5,6,7]}

select name, part_type, compact_map from system.parts where table = \'10027_test_map_in_memory_format\' and active = 1
all_1_2_2	Wide	1
-------------------------------------------------------------
alter settings and trigger merge action, it will generate parts in uncompacted map format

select id, string_params, string_params{\'s1\'}, string_list_params from test.10027_test_map_in_memory_format
1000	{'s1':'s_v1','s2':'s_v2'}	s_v1	{'s_l1':['l_v1','l_v2','l_v3']}
1001	{'s3':'s_v3','s4':'s_v4'}	\N	{'s_l2':['l_v4','l_v5']}
1002	{'s4':'s_v3','s5':'s_v5'}	\N	{'s_l2':['l_2'],'s_l3':['l_3']}

select id, int_params, int_params{\'i1\'}, int_list_params from test.10027_test_map_in_memory_format
1000	{'i1':1,'i2':2}	1	{'i_l1':[1,2,3],'i_l2':[4,5,6]}
1001	{'i2':1,'i3':3}	\N	{'i_l3':[4,5,6,7]}
1002	{'i4':4}	\N	{'i_l4':[6,7]}

select name, part_type, compact_map from system.parts where table = \'10027_test_map_in_memory_format\' and active = 1
all_1_3_3	Wide	0
