SET enable_optimizer = 1;

use test;
DROP TABLE IF EXISTS test.t40032_local;
DROP TABLE IF EXISTS test.t40032;

CREATE TABLE test.t40032_local (`arr` Array(UInt16), `cnt` UInt64 ) ENGINE = MergeTree() ORDER BY tuple();
CREATE TABLE t40032 AS t40032_local Engine=Distributed(test_shard_localhost, currentDatabase(), t40032_local);

INSERT INTO test.t40032 VALUES ([1],11555);
INSERT INTO test.t40032 VALUES ([1,1],8435);
INSERT INTO test.t40032 VALUES ([1,1,1],517);
INSERT INTO test.t40032 VALUES ([1,1,1,1],1126);
INSERT INTO test.t40032 VALUES ([1,1,1,1,1],95);
INSERT INTO test.t40032 VALUES ([1,1,1,1,1,1],319);
INSERT INTO test.t40032 VALUES ([1,1,1,1,1,1,1],40);
INSERT INTO test.t40032 VALUES ([1,1,1,1,1,1,1,1],135);
INSERT INTO test.t40032 VALUES ([1,1,1,1,1,1,1,1,1],21);
INSERT INTO test.t40032 VALUES ([1,1,1,1,1,1,1,1,1,1],373);
INSERT INTO test.t40032 VALUES ([1,1,1,1,1,1,1,1,2,2],16);
INSERT INTO test.t40032 VALUES ([1,1,1,1,1,1,1,2,2,1],1);
INSERT INTO test.t40032 VALUES ([1,1,1,1,1,1,2,2],10);
INSERT INTO test.t40032 VALUES ([1,1,1,1,1,1,2,2,1],1);
INSERT INTO test.t40032 VALUES ([1,1,1,1,1,1,2,2,1,1],5);
INSERT INTO test.t40032 VALUES ([1,1,1,1,1,1,2,2,2,2],11);
INSERT INTO test.t40032 VALUES ([1,1,1,1,1,2,2],1);
INSERT INTO test.t40032 VALUES ([1,1,1,1,1,2,2,1,1,1],1);
INSERT INTO test.t40032 VALUES ([1,1,1,1,2],1);
INSERT INTO test.t40032 VALUES ([1,1,1,1,2,2],107);
INSERT INTO test.t40032 VALUES ([1,1,1,1,2,2,1,1],9);
INSERT INTO test.t40032 VALUES ([1,1,1,1,2,2,1,1,1,1],9);
INSERT INTO test.t40032 VALUES ([1,1,1,1,2,2,1,1,2,2],8);
INSERT INTO test.t40032 VALUES ([1,1,1,1,2,2,2,2],33);
INSERT INTO test.t40032 VALUES ([1,1,1,1,2,2,2,2,1,1],4);
INSERT INTO test.t40032 VALUES ([1,1,1,1,2,2,2,2,2,2],32);
INSERT INTO test.t40032 VALUES ([1,1,1,2],2);
INSERT INTO test.t40032 VALUES ([1,1,1,2,2],2);
INSERT INTO test.t40032 VALUES ([1,1,1,2,2,1],4);
INSERT INTO test.t40032 VALUES ([1,1,1,2,2,1,1],3);
INSERT INTO test.t40032 VALUES ([1,1,1,2,2,1,1,1,1,1],1);
INSERT INTO test.t40032 VALUES ([1,1,1,2,2,1,2,2,1,1],1);
INSERT INTO test.t40032 VALUES ([1,1,2],22);
INSERT INTO test.t40032 VALUES ([1,1,2,1],1);
INSERT INTO test.t40032 VALUES ([1,1,2,1,1],1);
INSERT INTO test.t40032 VALUES ([1,1,2,1,1,1,1,1,1,1],1);
INSERT INTO test.t40032 VALUES ([1,1,2,2],685);
INSERT INTO test.t40032 VALUES ([1,1,2,2,1],8);
INSERT INTO test.t40032 VALUES ([1,1,2,2,1,1],42);
INSERT INTO test.t40032 VALUES ([1,1,2,2,1,1,1],1);
INSERT INTO test.t40032 VALUES ([1,1,2,2,1,1,1,1],10);
INSERT INTO test.t40032 VALUES ([1,1,2,2,1,1,1,1,1,1],11);
INSERT INTO test.t40032 VALUES ([1,1,2,2,1,1,1,1,2,2],4);
INSERT INTO test.t40032 VALUES ([1,1,2,2,1,1,2,2],18);
INSERT INTO test.t40032 VALUES ([1,1,2,2,1,1,2,2,1,1],4);
INSERT INTO test.t40032 VALUES ([1,1,2,2,1,1,2,2,2,2],14);
INSERT INTO test.t40032 VALUES ([1,1,2,2,2,2],184);
INSERT INTO test.t40032 VALUES ([1,1,2,2,2,2,1],3);
INSERT INTO test.t40032 VALUES ([1,1,2,2,2,2,1,1],16);
INSERT INTO test.t40032 VALUES ([1,1,2,2,2,2,1,1,1],1);
INSERT INTO test.t40032 VALUES ([1,1,2,2,2,2,1,1,1,1],5);
INSERT INTO test.t40032 VALUES ([1,1,2,2,2,2,1,1,2,2],6);
INSERT INTO test.t40032 VALUES ([1,1,2,2,2,2,2,2],69);
INSERT INTO test.t40032 VALUES ([1,1,2,2,2,2,2,2,1,1],6);
INSERT INTO test.t40032 VALUES ([1,1,2,2,2,2,2,2,2,2],79);
INSERT INTO test.t40032 VALUES ([1,2],168);
INSERT INTO test.t40032 VALUES ([1,2,1],23);
INSERT INTO test.t40032 VALUES ([1,2,1,1],2);
INSERT INTO test.t40032 VALUES ([1,2,1,1,1,1,1,1,1,1],1);
INSERT INTO test.t40032 VALUES ([1,2,1,1,2,1],1);
INSERT INTO test.t40032 VALUES ([1,2,1,2],2);
INSERT INTO test.t40032 VALUES ([1,2,1,2,2,1,1],1);
INSERT INTO test.t40032 VALUES ([1,2,1,2,2,2,2],1);
INSERT INTO test.t40032 VALUES ([1,2,2],294);
INSERT INTO test.t40032 VALUES ([1,2,2,1],39);
INSERT INTO test.t40032 VALUES ([1,2,2,1,1],10);
INSERT INTO test.t40032 VALUES ([1,2,2,1,1,1],2);
INSERT INTO test.t40032 VALUES ([1,2,2,1,1,1,1],1);
INSERT INTO test.t40032 VALUES ([1,2,2,1,1,1,1,1,1],1);
INSERT INTO test.t40032 VALUES ([1,2,2,1,1,1,1,1,1,1],2);
INSERT INTO test.t40032 VALUES ([1,2,2,1,1,1,2,2],1);
INSERT INTO test.t40032 VALUES ([1,2,2,1,1,2,1,1,1,2],1);
INSERT INTO test.t40032 VALUES ([1,2,2,1,1,2,2],1);
INSERT INTO test.t40032 VALUES ([1,2,2,1,2],1);
INSERT INTO test.t40032 VALUES ([1,2,2,1,2,2],5);
INSERT INTO test.t40032 VALUES ([1,2,2,2],9);
INSERT INTO test.t40032 VALUES ([1,2,2,2,1],3);
INSERT INTO test.t40032 VALUES ([1,2,2,2,1,2,1,1],1);
INSERT INTO test.t40032 VALUES ([1,2,2,2,2],26);
INSERT INTO test.t40032 VALUES ([1,2,2,2,2,1,1],1);
INSERT INTO test.t40032 VALUES ([1,2,2,2,2,1,1,1],1);
INSERT INTO test.t40032 VALUES ([1,2,2,2,2,1,1,2,1,1],1);
INSERT INTO test.t40032 VALUES ([1,2,2,2,2,2],2);
INSERT INTO test.t40032 VALUES ([1,2,2,2,2,2,2],4);
INSERT INTO test.t40032 VALUES ([1,2,2,2,2,2,2,2],1);
INSERT INTO test.t40032 VALUES ([1,2,2,2,2,2,2,2,2],1);
INSERT INTO test.t40032 VALUES ([1,2,2,2,2,2,2,2,2,2],1);

SELECT pathCount(10, 10)(path, 1, cnt) AS pathfind
FROM
    (
        select arrayMap(x -> tuple(x, ''), arr) as path, cnt from test.t40032
    );
    
DROP TABLE IF EXISTS test.t40032_local;
DROP TABLE IF EXISTS test.t40032;
