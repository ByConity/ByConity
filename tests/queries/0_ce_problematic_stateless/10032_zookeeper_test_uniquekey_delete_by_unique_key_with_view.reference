create materialized view from source table to ha unique table
select source table
2021-07-13 18:50:00	10001	5	500	0
2021-07-13 18:50:00	10002	2	200	0
2021-07-13 18:50:00	10003	1	100	0
2021-07-13 18:50:01	10002	4	400	0
2021-07-13 18:50:01	10004	1	100	0
2021-07-14 18:50:01	10003	2	200	0
select ha unique table r1
2021-07-13 18:50:00	10001	5	500
2021-07-13 18:50:00	10003	1	100
2021-07-13 18:50:01	10002	4	400
2021-07-13 18:50:01	10004	1	100
2021-07-14 18:50:01	10003	2	200
select ha unique table r2
2021-07-13 18:50:00	10001	5	500
2021-07-13 18:50:00	10003	1	100
2021-07-13 18:50:01	10002	4	400
2021-07-13 18:50:01	10004	1	100
2021-07-14 18:50:01	10003	2	200

delete data of pair(2021-07-13, 10002) and pair(2021-07-14, 10003)
select ha unique table r1
2021-07-13 18:50:00	10001	5	500
2021-07-13 18:50:00	10003	1	100
2021-07-13 18:50:01	10004	1	100
select ha unique table r2
2021-07-13 18:50:00	10001	5	500
2021-07-13 18:50:00	10003	1	100
2021-07-13 18:50:01	10004	1	100

delete data whose revenue is bigger than 500
select ha unique table r1
2021-07-13 18:50:00	10003	1	100
2021-07-13 18:50:01	10004	1	100
select ha unique table r2
2021-07-13 18:50:00	10003	1	100
2021-07-13 18:50:01	10004	1	100

clear source table and update materialized view to another replica, it will add new rows whose amount >= 10, delete old rows whose amount < 10, using expressions
select ha unique table r1
2021-07-13 18:50:00	10003	1	100
2021-07-13 18:50:01	10004	1	100
select ha unique table r2
2021-07-13 18:50:00	10003	1	100
2021-07-13 18:50:01	10004	1	100

insert 3 rows, the amount of 2 rows is less than 10, which will delete pair (2021-07-13, 10003) and add pair (2021-07-16, 10003)
select source table
2021-07-13 18:50:01	10003	4	400	0
2021-07-16 18:50:01	10003	20	200	0
2021-07-16 18:50:01	10004	9	100	0
select ha unique table r1
2021-07-13 18:50:01	10004	1	100
2021-07-16 18:50:01	10003	20	200
select ha unique table r2
2021-07-13 18:50:01	10004	1	100
2021-07-16 18:50:01	10003	20	200
